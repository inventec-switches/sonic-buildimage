From 66371515ebd1740d154f4a7a3acf095680911f02 Mon Sep 17 00:00:00 2001
From: Clare Lu <lu.clare@inventec.com>
Date: Tue, 4 Dec 2018 13:43:09 +0800
Subject: [PATCH] Bug3593: [Maple][SONiC][ACL]After config stage to egress, the
 oper status of ports will be down

---
 orchagent/aclorch.cpp | 33 ++++++++++++++++++++++++++++++++-
 1 file changed, 32 insertions(+), 1 deletion(-)

diff --git a/orchagent/aclorch.cpp b/orchagent/aclorch.cpp
index 686c32c..90d519c 100644
--- a/orchagent/aclorch.cpp
+++ b/orchagent/aclorch.cpp
@@ -1022,7 +1022,38 @@ bool AclTable::create()
 
     sai_attribute_t attr;
     vector<sai_attribute_t> table_attrs;
-    vector<int32_t> bpoint_list = { SAI_ACL_BIND_POINT_TYPE_PORT, SAI_ACL_BIND_POINT_TYPE_LAG };
+
+    set<sai_acl_bind_point_type_t> binds;
+    for (const auto& portid_pair : ports)
+    {
+        Port port;
+        if (!gPortsOrch->getPort(portid_pair.first, port))
+        {
+            continue;
+        }
+
+        switch (port.m_type)
+        {
+            case Port::PHY:
+                binds.insert(SAI_ACL_BIND_POINT_TYPE_PORT);
+                break;
+            case Port::VLAN:
+                binds.insert(SAI_ACL_BIND_POINT_TYPE_VLAN);
+                break;
+            case Port::LAG:
+                binds.insert(SAI_ACL_BIND_POINT_TYPE_LAG);
+                break;
+            default:
+                return SAI_STATUS_FAILURE;
+        }
+    }
+
+    vector<int32_t> bpoint_list;
+    for (auto bind : binds)
+    {
+        bpoint_list.push_back(bind);
+    }
+
     attr.id = SAI_ACL_TABLE_ATTR_ACL_BIND_POINT_TYPE_LIST;
     attr.value.s32list.count = static_cast<uint32_t>(bpoint_list.size());
     attr.value.s32list.list = bpoint_list.data();
-- 
2.1.4

